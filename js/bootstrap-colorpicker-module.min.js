angular.module("colorpicker.module",[]).factory("Helper",function(){"use strict";return{closestSlider:function(o){var e=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.msMatchesSelector;return e.bind(o)("I")?o.parentNode:o},getOffset:function(o,e){for(var t=0,r=0,a=o.getBoundingClientRect();o&&!isNaN(o.offsetLeft)&&!isNaN(o.offsetTop);)e||"BODY"!==o.tagName?(t+=o.scrollLeft,r+=o.scrollTop):(t+=document.documentElement.scrollLeft||o.scrollLeft,r+=document.documentElement.scrollTop||o.scrollTop),o=o.offsetParent;return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset,scrollX:t,scrollY:r}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return[o[1],o[2],o[3],o[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return[2.55*o[1],2.55*o[2],2.55*o[3],o[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}]}}).factory("Color",["Helper",function(o){"use strict";return{value:{h:1,s:1,b:1,a:1},rgb:function(){var o=this.toRGB();return"rgb("+o.r+","+o.g+","+o.b+")"},rgba:function(){var o=this.toRGB();return"rgba("+o.r+","+o.g+","+o.b+","+o.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(o,e,t,r){o/=255,e/=255,t/=255;var a,n,l,c;return l=Math.max(o,e,t),c=l-Math.min(o,e,t),a=0===c?null:l===o?(e-t)/c:l===e?(t-o)/c+2:(o-e)/c+4,a=(a+360)%6*60/360,n=0===c?0:c/l,{h:a||1,s:n,b:l,a:r||1}},setColor:function(e){e=e?e.toLowerCase():e;for(var t in o.stringParsers)if(o.stringParsers.hasOwnProperty(t)){var r=o.stringParsers[t],a=r.re.exec(e),n=a&&r.parse(a);if(n)return this.value=this.RGBtoHSB.apply(null,n),!1}},setHue:function(o){this.value.h=1-o},setSaturation:function(o){this.value.s=o},setLightness:function(o){this.value.b=1-o},setAlpha:function(o){this.value.a=parseInt(100*(1-o),10)/100},toRGB:function(o,e,t,r){o||(o=this.value.h,e=this.value.s,t=this.value.b),o*=360;var a,n,l,c,i;return o=o%360/60,i=t*e,c=i*(1-Math.abs(o%2-1)),a=n=l=t-i,o=~~o,a+=[i,c,0,0,c,i][o],n+=[c,i,i,c,0,0][o],l+=[0,0,c,i,i,c][o],{r:Math.round(255*a),g:Math.round(255*n),b:Math.round(255*l),a:r||this.value.a}},toHex:function(o,e,t,r){var a=this.toRGB(o,e,t,r);return"#"+(1<<24|parseInt(a.r,10)<<16|parseInt(a.g,10)<<8|parseInt(a.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(o){"use strict";var e={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},t={};return{getSlider:function(){return e},getLeftPosition:function(o){return Math.max(0,Math.min(e.maxLeft,e.left+((o.pageX||t.left)-t.left)))},getTopPosition:function(o){return Math.max(0,Math.min(e.maxTop,e.top+((o.pageY||t.top)-t.top)))},setSlider:function(r,a){var n=o.closestSlider(r.target),l=o.getOffset(n,a),c=n.getBoundingClientRect(),i=r.clientX-c.left,s=r.clientY-c.top;e.knob=n.children[0].style,e.left=r.pageX-l.left-window.pageXOffset+l.scrollX,e.top=r.pageY-l.top-window.pageYOffset+l.scrollY,t={left:r.pageX-(i-e.left),top:r.pageY-(s-e.top)}},setSaturation:function(o,t,r){e={maxLeft:r,maxTop:r,callLeft:"setSaturation",callTop:"setLightness"},this.setSlider(o,t)},setHue:function(o,t,r){e={maxLeft:0,maxTop:r,callLeft:!1,callTop:"setHue"},this.setSlider(o,t)},setAlpha:function(o,t,r){e={maxLeft:0,maxTop:r,callLeft:!1,callTop:"setAlpha"},this.setSlider(o,t)},setKnob:function(o,t){e.knob.top=o+"px",e.knob.left=t+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function(o,e,t,r,a){"use strict";return{require:"?ngModel",restrict:"A",link:function(n,l,c,i){function s(){o.on("mousemove",p),o.on("mouseup",f)}function u(){try{Y.css("backgroundColor",D[w]())}catch(o){Y.css("backgroundColor",D.toHex())}V.css("backgroundColor",D.toHex(D.value.h,1,1,1)),"rgba"===w&&(x.css.backgroundColor=D.toHex())}function p(o){var e=r.getLeftPosition(o),t=r.getTopPosition(o),a=r.getSlider();r.setKnob(t,e),a.callLeft&&D[a.callLeft].call(D,e/L),a.callTop&&D[a.callTop].call(D,t/L),H&&"setHue"===a.callTop&&(D.setSaturation.call(D,1),D.setLightness.call(D,0)),u();var c=D[w]();return l.val(c),i&&n.$apply(i.$setViewValue(c)),I&&N.val(c),!1}function f(){v("colorpicker-selected"),o.off("mousemove",p),o.off("mouseup",f)}function d(o){D.value=B,D.setColor(l.val()),I&&!o&&N.val(l.val()),k(),u()}function k(){R.eq(0).css({left:D.value.s*L+"px",top:L-D.value.b*L+"px"}),R.eq(1).css("top",L*(1-D.value.h)+"px"),R.eq(2).css("top",L*(1-D.value.a)+"px"),B=D.value,u()}function h(){var o,e=a.getOffset(l[0]),t=2;return angular.isDefined(c.colorpickerParent)&&(e.left=0,e.top=0),"top"===$?o={top:e.top-G-t,left:e.left}:"right"===$?o={top:e.top,left:e.left+l[0].offsetWidth+t}:"bottom"===$?o={top:e.top+l[0].offsetHeight+t,left:e.left}:"left"===$&&(o={top:e.top,left:e.left-X-t}),{top:o.top+"px",left:o.left+"px"}}function b(){m()}function g(){z||M.hasClass("colorpicker-visible")||(d(),M.addClass("colorpicker-visible").css(h()),v("colorpicker-shown"),y===!1&&o.on("mousedown",b),c.colorpickerIsOpen&&(n[c.colorpickerIsOpen]=!0,n.$$phase&&n.$root.$$phase||n.$digest()))}function v(o){i&&n.$emit(o,{name:c.ngModel,value:i.$modelValue})}function m(){M.hasClass("colorpicker-visible")&&(M.removeClass("colorpicker-visible"),v("colorpicker-closed"),o.off("mousedown",b),c.colorpickerIsOpen&&(n[c.colorpickerIsOpen]=!1,n.$$phase&&n.$root.$$phase||n.$digest()))}var x,w=c.colorpicker?c.colorpicker:"hex",$=angular.isDefined(c.colorpickerPosition)?c.colorpickerPosition:"bottom",y=!!angular.isDefined(c.colorpickerInline)&&c.colorpickerInline,S=!!angular.isDefined(c.colorpickerFixedPosition)&&c.colorpickerFixedPosition,C=angular.isDefined(c.colorpickerParent)?l.parent():angular.element(document.body),I=!!angular.isDefined(c.colorpickerWithInput)&&c.colorpickerWithInput,L=angular.isDefined(c.colorpickerSize)?c.colorpickerSize:100,T=L+"px",H=angular.isDefined(c.colorpickerFullSaturation),P=I?'<input type="text" name="colorpicker-input" spellcheck="false">':"",q=y?"":'<button type="button" class="close close-colorpicker">&times;</button>',O=angular.isDefined(c.colorpickerClass)?c.colorpickerClass:"",A='<div class="colorpicker dropdown '+O+'"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview>'+P+'<div><button type="button" class="colorpicker-quickalpha" data-alpha="1"><span class="fa-stack" style="font-size: 0.5em;vertical-align:top;"><i class="fas fa-circle-notch fa-stack-2x fa-rotate-90"></i><i class="fas fa-circle-notch fa-stack-2x"></i></span></button><button type="button" class="colorpicker-quickalpha" data-alpha="0.5"><i class="fas fa-adjust"></i></button><button type="button" class="colorpicker-quickalpha" data-alpha="0"><i class="fas fa-circle"></i></button></div>'+q+'<div><button type="button" class="colorpicker-quickcolor" data-color="rgb(0,0,255)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(0,255,255)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(0,255,0)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(255,255,0)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(255,0,0)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(255,0,255)"></button><button type="button" class="colorpicker-quickcolor" data-color="rgb(255,255,255)"></button></div></div></div>',M=angular.element(A),D=t,B={h:1,s:0,b:1,a:1},F=M.find("colorpicker-hue"),V=M.find("colorpicker-saturation"),Y=M.find("colorpicker-preview"),R=M.find("i"),X=parseInt(L)+29+("rgba"===w?15:0),G=parseInt(L)+55;if(e(M)(n),M.css("min-width",X+"px"),V.css({width:T,height:T}),F.css("height",T),I){var N=M.find("input");N.css("width",T),N.on("mousedown",function(o){o.stopPropagation()}).on("keyup",function(){var o=this.value;/^#([0-9A-Z]{3}){1,2}$/i.test(o)&&(l.val(o),i&&i.$modelValue!==o&&(n.$apply(i.$setViewValue(o)),d(!0)))})}"rgba"===w?(M.addClass("alpha"),x=M.find("colorpicker-alpha"),x.css("height",T),x.on("click",function(o){r.setAlpha(o,S,L),p(o)}).on("mousedown",function(o){r.setAlpha(o,S,L),s()}).on("mouseup",function(o){v("colorpicker-selected-alpha")}),M.find(".colorpicker-quickalpha").on("click",function(o){var e=parseFloat(o.currentTarget.attributes["data-alpha"].value);D.setAlpha.call(D,e),k(),u();var t=D[w]();l.val(t),i&&n.$apply(i.$setViewValue(t)),I&&N.val(t),v("colorpicker-selected-alpha")})):M.find(".colorpicker-quickalpha").hide(),M.find(".colorpicker-quickcolor").on("click",function(o){var e=o.currentTarget.attributes["data-color"].value,t=1-parseFloat(D.value.a);D.setColor(e),D.setAlpha(t),k(),u();var r=D[w]();l.val(r),i&&n.$apply(i.$setViewValue(r)),I&&N.val(r),v("colorpicker-selected-color")}).each(function(){var o=this.attributes["data-color"].value;angular.element(this).css("background-color",o)}),F.on("click",function(o){r.setHue(o,S,L),p(o)}).on("mousedown",function(o){r.setHue(o,S,L),s()}).on("mouseup",function(o){v("colorpicker-selected-hue")}),V.on("click",function(o){r.setSaturation(o,S,L),p(o),angular.isDefined(c.colorpickerCloseOnSelect)&&m()}).on("mousedown",function(o){r.setSaturation(o,S,L),s()}).on("mouseup",function(o){v("colorpicker-selected-saturation")}),S&&M.addClass("colorpicker-fixed-position"),M.addClass("colorpicker-position-"+$),"true"===y&&M.addClass("colorpicker-inline"),C.append(M),i&&(i.$render=function(){l.val(i.$viewValue),d()}),l.on("blur keyup change",function(){d()}),l.on("$destroy",function(){M.remove()});var z=!1;y===!1?(l.on("mousedown",function(){z=M.hasClass("colorpicker-visible")}),l.on("click",g)):g(),M.on("mousedown",function(o){o.stopPropagation(),o.preventDefault()}),M.find("button.close-colorpicker").on("click",function(){m()}),c.colorpickerIsOpen&&n.$watch(c.colorpickerIsOpen,function(o){o===!0?g():o===!1&&m()})}}}]);